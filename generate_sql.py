# generate_sql.py (æ›´æ–°ç‰ˆï¼šç›´æ¥å¯«å…¥è³‡æ–™åº«)
import json
import random
import sys
import os

# å°‡è·¯å¾‘è¨­ç‚ºå°ˆæ¡ˆæ ¹ç›®éŒ„ï¼Œç¢ºä¿èƒ½è®€å–åˆ° src
sys.path.append(os.getcwd())

from src.database import get_db_connection  # åŒ¯å…¥å°ˆæ¡ˆåŸæœ¬çš„é€£ç·šè¨­å®š

# ==========================================
# 1. è³‡æ–™æ¨¡ç‰ˆè¨­å®š (èˆ‡ä¹‹å‰ç›¸åŒ)
# ==========================================
data_templates = [
    {
        "category": "ç·Šæ€¥æ±‚åŠ©",
        "danger": 5,
        "action": "SHOW_CRISIS_MENU",
        "response_pool": [
            "åŒå­¸ï¼Œè«‹å…ˆåœä¸‹ä¾†ï¼Œæˆ‘å€‘å¾ˆé‡è¦–ä½ çš„å®‰å…¨ã€‚ğŸ‘‡ è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œæœ‰äººæœƒé¦¬ä¸Šè½ä½ èªªã€‚",
            "æ·±å‘¼å¸ï¼Œä½ ç¾åœ¨ä¸å­¤å–®ã€‚æˆ‘å€‘æœ‰å°ˆæ¥­çš„äººå“¡å¯ä»¥å”åŠ©ä½ ï¼Œè«‹çœ‹ä¸‹é¢çš„è³‡æºã€‚",
            "æˆ‘çŸ¥é“ç¾åœ¨å¾ˆç—›è‹¦ï¼Œä½†è«‹çµ¦æˆ‘å€‘ä¸€å€‹æ©Ÿæœƒå¹«åŠ©ä½ ã€‚ğŸ‘‡",
            "ä½ çš„ç”Ÿå‘½å¾ˆé‡è¦ï¼Œè«‹è®“æˆ‘å€‘å”åŠ©ä½ åº¦éé€™å€‹æ™‚åˆ»ã€‚"
        ],
        "keywords_pool": [
            ["æ­»", "è‡ªæ®º", "ä¸æƒ³æ´»"],
            ["å‰²è…•", "æµè¡€", "ç—›"],
            ["æ¶ˆå¤±", "å†è¦‹", "çµ•æœ›"],
            ["è·³æ¨“", "é ‚æ¨“", "å±éšª"],
            ["è—¥", "å", "éé‡"]
        ]
    },
    {
        "category": "èº«é«”ç•Œç·š",
        "danger": 3,
        "action": "LINK_LEGAL_INFO",
        "response_pool": [
            "é€™è½èµ·ä¾†å¯èƒ½æ¶‰åŠæ€§é¨·æ“¾ï¼Œä½ çš„æ„Ÿè¦ºå¾ˆé‡è¦ã€‚ä½ æƒ³äº†è§£å¦‚ä½•ä¿è­·è‡ªå·±å—ï¼Ÿ",
            "å°æ–¹é€™æ¨£çš„è¡Œç‚ºæ˜¯ä¸å°çš„ã€‚å¦‚æœä½ æ„Ÿåˆ°ä¸èˆ’æœï¼Œé‚£æ˜¯å› ç‚ºä½ çš„ç•Œç·šè¢«ä¾µçŠ¯äº†ã€‚",
            "é€™å¯èƒ½å·²ç¶“è§¸çŠ¯äº†æ³•å¾‹ä¸­çš„æ€§é¨·æ“¾é˜²æ²»æ³•ã€‚éœ€è¦æˆ‘ç‚ºä½ è§£é‡‹ç›¸é—œæ¬Šç›Šå—ï¼Ÿ",
            "ç™¼ç”Ÿé€™æ¨£çš„äº‹ä¸æ˜¯ä½ çš„éŒ¯ã€‚æˆ‘å€‘å¯ä»¥ä¸€èµ·çœ‹çœ‹æœ‰å“ªäº›æ³•å¾‹é€”å¾‘å¯ä»¥å”åŠ©ä½ ã€‚"
        ],
        "keywords_pool": [
            ["æ‘¸", "å¤§è…¿", "èƒ¸éƒ¨"],
            ["å¼·å»", "æ“æŠ±", "ä¸èˆ’æœ"],
            ["æ€§é¨·æ“¾", "è®Šæ…‹", "å™å¿ƒ"],
            ["è„«", "è£¸ç…§", "å¤–æµ"],
            ["å¼·è¿«", "åšæ„›", "ç™¼ç”Ÿé—œä¿‚"]
        ]
    },
    {
        "category": "æƒ…ç·’æ”¯æŒ",
        "danger": 1,
        "action": "AI_EMPATHY_RESPONSE",
        "response_pool": [
            "è½èµ·ä¾†ä½ æœ€è¿‘å£“åŠ›å¾ˆå¤§ï¼Œé¡˜æ„å¤šè·Ÿæˆ‘èªªä¸€é»å—ï¼Ÿ",
            "é€™ç¨®æ„Ÿè¦ºçœŸçš„å¾ˆé›£å—ï¼Œä¸éæˆ‘åœ¨é€™è£¡é™ªä½ ã€‚",
            "ä½ å¯ä»¥æŠŠé€™è£¡ç•¶ä½œæ¨¹æ´ï¼Œèªªå‡ºä¾†å¿ƒè£¡æˆ–è¨±æœƒå¥½å—ä¸€äº›ã€‚",
            "æ²’é—œä¿‚çš„ï¼Œæƒ³å“­å°±å“­å‡ºä¾†ï¼Œæƒ…ç·’éœ€è¦å‡ºå£ã€‚"
        ],
        "keywords_pool": [
            ["é›£é", "å“­", "å‚·å¿ƒ"],
            ["å£“åŠ›", "å¥½å¤§", "å´©æ½°"],
            ["å¯‚å¯", "æ²’äººç†", "é‚Šç·£"],
            ["ç”Ÿæ°£", "æ†¤æ€’", "ä¸çˆ½"],
            ["ç„¦æ…®", "ç¡ä¸è‘—", "å¤±çœ "]
        ]
    },
    {
        "category": "æ‰“æ‹›å‘¼èˆ‡é–’èŠ",
        "danger": 0,
        "action": "SHOW_MAIN_MENU",
        "response_pool": [
            "å—¨ï¼æˆ‘åœ¨é€™è£¡é™ªä½ ï¼Œæœ‰ä»€éº¼æƒ³èªªçš„å—ï¼Ÿ",
            "å“ˆå›‰ï¼ä»Šå¤©éå¾—é‚„å¥½å—ï¼Ÿ",
            "å—¨å—¨ï¼Œæˆ‘æ˜¯ä½ çš„å°åŠ©æ‰‹ï¼Œéš¨æ™‚éƒ½å¯ä»¥æ‰¾æˆ‘èŠèŠå–”ã€‚",
            "ä½ å¥½å‘€ï¼æœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«ä½ çš„å—ï¼Ÿ"
        ],
        "keywords_pool": [
            ["å—¨", "ä½ å¥½", "å“ˆå›‰"],
            ["æ—©å®‰", "åˆå®‰", "æ™šå®‰"],
            ["åœ¨å—", "æœ‰äººå—", "test"],
            ["ä½ æ˜¯èª°", "æ©Ÿå™¨äºº", "ä»‹ç´¹"],
            ["ç„¡èŠ", "èŠå¤©", "è¬›ç¬‘è©±"]
        ]
    },
    {
        "category": "æ³•å¾‹è«®è©¢",
        "danger": 2,
        "action": "SEARCH_LEGAL_DB",
        "response_pool": [
            "é—œæ–¼æ³•å¾‹å•é¡Œï¼Œå»ºè­°ä¿ç•™è­‰æ“šæ˜¯ç¬¬ä¸€æ­¥ã€‚ä½ æƒ³çŸ¥é“æ€éº¼è’è­‰å—ï¼Ÿ",
            "é€™å¯èƒ½æ¶‰åŠåˆ‘æ³•æˆ–æ€§å¹³æ³•ã€‚æˆ‘å¯ä»¥å¹«ä½ æŸ¥æ‰¾ç›¸é—œæ¢æ–‡ã€‚",
            "é‡åˆ°é€™ç¨®æ³•å¾‹å•é¡Œï¼Œä½ æ˜¯æœªæˆå¹´äººå—ï¼Ÿæ³•å¾‹å°æœªæˆå¹´äººæœ‰ç‰¹åˆ¥ä¿è­·ã€‚",
            "æˆ‘å€‘å¯ä»¥å”åŠ©ä½ å°‹æ‰¾æ³•å¾‹æ‰¶åŠ©è³‡æºï¼Œéœ€è¦å—ï¼Ÿ"
        ],
        "keywords_pool": [
            ["æ³•å¾‹", "å‘Šä»–", "è­¦å¯Ÿ"],
            ["è­‰æ“š", "æˆªåœ–", "éŒ„éŸ³"],
            ["æå‘Š", "æ³•é™¢", "åˆ¤åˆ‘"],
            ["æœªæˆå¹´", "ä¿è­·ä»¤", "ç¤¾å·¥"],
            ["å¾‹å¸«", "è«®è©¢", "è²»ç”¨"]
        ]
    }
]

modifiers = ["ç¾åœ¨", "çœŸçš„", "è¦ºå¾—", "å¥½", "ä¸€ç›´", "çªç„¶"]

# ==========================================
# 2. æ ¸å¿ƒåŠŸèƒ½ï¼šç”Ÿæˆä¸¦å¯«å…¥è³‡æ–™åº«
# ==========================================
def seed_database(num_rows=100):
    print(f"ğŸš€ æ­£åœ¨ç”Ÿæˆ {num_rows} ç­†è³‡æ–™ä¸¦æº–å‚™å¯«å…¥è³‡æ–™åº«...")
    
    data_to_insert = []
    
    for _ in range(num_rows):
        # éš¨æ©Ÿé¸å–æ¨¡ç‰ˆ
        template = random.choice(data_templates)
        
        # éš¨æ©Ÿçµ„åˆé—œéµå­—
        base_keywords = random.choice(template["keywords_pool"])
        extra_word = random.choice(modifiers)
        
        final_keywords = base_keywords.copy()
        if random.random() > 0.5:
            final_keywords.append(extra_word)
            
        # æº–å‚™å–®ç­†è³‡æ–™ (Tuple æ ¼å¼)
        # æ³¨æ„ï¼šSQL éœ€è¦ JSON æ ¼å¼çš„å­—ä¸²ï¼Œæ‰€ä»¥é€™è£¡å…ˆ dumps
        data_to_insert.append((
            template['category'],
            json.dumps(final_keywords, ensure_ascii=False), # å°‡ list è½‰ç‚º JSON å­—ä¸²
            template['danger'],
            random.choice(template['response_pool']),
            template['action']
        ))

    # é–‹å§‹å¯«å…¥è³‡æ–™åº«
    try:
        conn = get_db_connection()
        cursor = conn.cursor()
        
        sql = """
            INSERT INTO bot_intents (category, keywords, danger, response, action) 
            VALUES (%s, %s, %s, %s, %s)
        """
        
        # executemany å¯ä»¥ä¸€æ¬¡å¯«å…¥å¤§é‡è³‡æ–™ï¼Œæ•ˆèƒ½æ¯”è¿´åœˆä¸€ç­†ç­† insert å¥½å¾ˆå¤š
        cursor.executemany(sql, data_to_insert)
        conn.commit()
        
        print(f"âœ… æˆåŠŸï¼å·²å°‡ {cursor.rowcount} ç­†æ–°å›è¦†å¯«å…¥ bot_intents è³‡æ–™è¡¨ã€‚")
        
    except Exception as e:
        print(f"âŒ å¯«å…¥å¤±æ•—: {e}")
    finally:
        if 'conn' in locals() and conn.is_connected():
            cursor.close()
            conn.close()

if __name__ == "__main__":
    # ä½ å¯ä»¥åœ¨é€™è£¡è¨­å®šè¦ç”¢ç”Ÿå¹¾ç­†ï¼Œä¾‹å¦‚ 200 ç­†
    seed_database(200)