<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ©Ÿå™¨äººè¨“ç·´å¾Œå°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .section-divider { border-top: 2px dashed #ccc; margin: 3rem 0; }
        .badge-keyword { margin-right: 3px; margin-bottom: 3px; display: inline-block; }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>ğŸ¤– Line Bot è¨“ç·´å¾Œå°</h1>
        <a href="/" class="btn btn-outline-secondary">å›åˆ°é¦–é </a>
    </div>

    <form action="/admin/submit" method="POST">
        <div class="card mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <strong>ğŸš€ 1. è¨“ç·´æ–°è©å½™ (Keyword Training)</strong>
            </div>
            <div class="card-body">
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Step 1: å‹¾é¸è¦å­¸ç¿’çš„æ–°è©å½™ (ä¾†è‡ª files è³‡æ–™å¤¾)</label>
                    <div class="p-3 border rounded bg-white">
                        <div class="row">
                            {% for word, count in top_words %}
                            <div class="col-md-3 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected_words" value="{{ word }}" id="word_{{ loop.index }}">
                                    <label class="form-check-label" for="word_{{ loop.index }}">
                                        {{ word }} <span class="badge bg-secondary">{{ count }}</span>
                                    </label>
                                </div>
                            </div>
                            {% else %}
                            <p class="text-muted">æ²’æœ‰åˆ†æåˆ°è©å½™ï¼Œè«‹ç¢ºèª files è³‡æ–™å¤¾æœ‰ .txt æª”æ¡ˆã€‚</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Step 2: æ±ºå®šé€™äº›è©è¦å»å“ªè£¡ï¼Ÿ</label>
                    <div class="p-3 border rounded bg-light">
                        <div class="mb-3">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="mode" id="mode1" value="existing" checked onclick="toggleMode('existing')">
                                <label class="form-check-label" for="mode1">åŠ å…¥ç¾æœ‰åˆ†é¡</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="mode" id="mode2" value="new" onclick="toggleMode('new')">
                                <label class="form-check-label" for="mode2">å»ºç«‹æ–°åˆ†é¡</label>
                            </div>
                        </div>

                        <div id="existing_section">
                            <select name="category_id" class="form-select">
                                {% for intent in intents %}
                                <option value="{{ intent.id }}">
                                    {{ intent.category }} (ç›®å‰ {{ intent.keywords|length }} è© / å±éšª: {{ intent.danger }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div id="new_section" style="display: none;">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <label class="small">åˆ†é¡åç¨±</label>
                                    <input type="text" name="new_category_name" class="form-control" placeholder="ä¾‹ï¼šå­¸æ¥­å£“åŠ›">
                                </div>
                                <div class="col-md-2">
                                    <label class="small">å±éšªç­‰ç´š (0-5)</label>
                                    <input type="number" name="danger_level" class="form-control" value="0" min="0" max="5">
                                </div>
                                <div class="col-md-3">
                                    <label class="small">è§¸ç™¼å‹•ä½œ</label>
                                    <select name="action_code" class="form-select">
                                        <option value="NONE">ç„¡ (ç´”æ–‡å­—)</option>
                                        <option value="SHOW_CRISIS_MENU">æ±‚åŠ©é¸å–®</option>
                                        <option value="SHOW_MAIN_MENU">ä¸»é¸å–®</option>
                                    </select>
                                </div>
                                <div class="col-md-12 mt-2">
                                    <label class="small">å›è¦†å…§å®¹</label>
                                    <textarea name="response_text" class="form-control" rows="1" placeholder="ä¾‹ï¼šé€™è½èµ·ä¾†å¾ˆè¾›è‹¦..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-100">ç¢ºèªæ›´æ–°è³‡æ–™åº«</button>
            </div>
        </div>
    </form>

    <div class="card mb-4 border-info">
        <div class="card-header bg-info text-dark">
            <strong>ğŸ¨ 2. æ–°å¢èªæ°£ä¿®é£¾èª (Add Modifiers)</strong>
        </div>
        <div class="card-body">
            <form action="/admin/modifier/add" method="POST" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label fw-bold">é¸æ“‡åˆ†é¡</label>
                    <select name="category" class="form-select">
                        <option value="default">default (é€šç”¨)</option>
                        {% for intent in intents %}
                        <option value="{{ intent.category }}">{{ intent.category }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label fw-bold">é¡å‹</label>
                    <select name="mod_type" class="form-select">
                        <option value="prefix">å‰ç¶´ (é–‹é ­å®‰æ…°)</option>
                        <option value="suffix">å¾Œç¶´ (çµå°¾æ”¯æŒ)</option>
                        <option value="particle">èªæ°£è© (çµå°¾è£é£¾)</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-bold">å…§å®¹</label>
                    <input type="text" name="content" class="form-control" placeholder="ä¾‹å¦‚ï¼šæˆ‘å€‘æœƒé™ªè‘—ä½ ã€‚" required>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-info w-100 text-dark">â• æ–°å¢</button>
                </div>
            </form>
        </div>
    </div>


    <div class="section-divider"></div>


    <div class="card border-secondary">
        <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center" 
             data-bs-toggle="collapse" data-bs-target="#collapseData" aria-expanded="false" style="cursor: pointer;">
            <h5 class="mb-0">ğŸ“‚ è³‡æ–™åº«å…§å®¹ç¸½è¦½ (é»æ“Šå±•é–‹/æ”¶åˆ)</h5>
            <span class="badge bg-light text-dark">é¡¯ç¤ºå…§å®¹</span>
        </div>
        
        <div id="collapseData" class="collapse">
            <div class="card-body">
                
                <h5 class="text-primary border-bottom pb-2">1. æ„åœ–èˆ‡é—œéµå­—åˆ—è¡¨ (Intents)</h5>
                <div class="table-responsive mb-5">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th width="15%">åˆ†é¡</th>
                                <th width="10%">å±éšªåº¦</th>
                                <th width="35%">é—œéµå­—</th>
                                <th width="40%">å›æ‡‰å…§å®¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for intent in intents %}
                            <tr>
                                <td class="fw-bold">{{ intent.category }}</td>
                                <td>
                                    {% if intent.danger >= 4 %}
                                        <span class="badge bg-danger">é«˜ ({{ intent.danger }})</span>
                                    {% elif intent.danger >= 2 %}
                                        <span class="badge bg-warning text-dark">ä¸­ ({{ intent.danger }})</span>
                                    {% else %}
                                        <span class="badge bg-success">ä½ ({{ intent.danger }})</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% for k in intent.keywords %}
                                        <span class="badge bg-white text-dark border badge-keyword">{{ k }}</span>
                                    {% endfor %}
                                </td>
                                <td class="small">{{ intent.response }}</td>
                            </tr>
                            {% else %}
                            <tr><td colspan="4" class="text-center">ç„¡è³‡æ–™</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <h5 class="text-info border-bottom pb-2">2. èªæ°£ä¿®é£¾èªåˆ—è¡¨ (Modifiers)</h5>
                <div class="table-responsive">
                    <table class="table table-hover table-bordered align-middle">
                        <thead class="table-light">
                            <tr>
                                <th width="20%">åˆ†é¡</th>
                                <th width="15%">é¡å‹</th>
                                <th width="50%">å…§å®¹</th>
                                <th width="15%">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if modifiers %}
                                {% for mod in modifiers %}
                                <tr>
                                    <td><span class="badge bg-secondary">{{ mod.category }}</span></td>
                                    <td>
                                        {% if mod.mod_type == 'prefix' %}<span class="badge bg-primary">å‰ç¶´</span>{% endif %}
                                        {% if mod.mod_type == 'suffix' %}<span class="badge bg-success">å¾Œç¶´</span>{% endif %}
                                        {% if mod.mod_type == 'particle' %}<span class="badge bg-warning text-dark">èªæ°£è©</span>{% endif %}
                                    </td>
                                    <td>{{ mod.content }}</td>
                                    <td>
                                        <form action="/admin/modifier/delete" method="POST" style="display:inline;">
                                            <input type="hidden" name="mod_id" value="{{ mod.id }}">
                                            <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')">åˆªé™¤</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr><td colspan="4" class="text-center text-muted">ç„¡è³‡æ–™</td></tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function toggleMode(mode) {
        if (mode === 'existing') {
            document.getElementById('existing_section').style.display = 'block';
            document.getElementById('new_section').style.display = 'none';
        } else {
            document.getElementById('existing_section').style.display = 'none';
            document.getElementById('new_section').style.display = 'block';
        }
    }
</script>

</body>
</html>