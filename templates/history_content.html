{% if user_id and history %}
    <div class="d-flex justify-content-between align-items-center mb-3 fade-in">
        <h5 class="mb-0 text-primary">User: {{ user_id[:8] }}... çš„å°è©±</h5>
        <a href="/admin/history/export/{{ user_id }}" class="btn btn-success btn-sm">ğŸ“¥ åŒ¯å‡º TXT</a>
    </div>

    <div class="chat-box border rounded bg-white p-3 shadow-sm fade-in" style="height: 500px; overflow-y: auto;">
        {% for row in history %}
            <div class="d-flex flex-column mb-3 {% if row.role == 'bot' %}align-items-end{% else %}align-items-start{% endif %}">
                <div class="d-flex align-items-center mb-1">
                    <span class="badge {% if row.role == 'bot' %}bg-primary{% else %}bg-secondary{% endif %} me-2">
                        {% if row.role == 'bot' %}Bot{% else %}User{% endif %}
                    </span>
                    <small class="text-muted" style="font-size: 0.75em;">{{ row.created_at }}</small>
                </div>
                <div class="p-2 rounded text-break" 
                     style="max-width: 80%; background-color: {% if row.role == 'bot' %}#cfe2ff{% else %}#f8f9fa{% endif %}; border: 1px solid #dee2e6;">
                    {{ row.message }}
                </div>
            </div>
        {% endfor %}
        <div id="bottom-anchor"></div>
    </div>
{% elif user_id %}
    <div class="alert alert-warning mt-3 fade-in">æ‰¾ä¸åˆ°æ­¤ User ID çš„ç´€éŒ„ã€‚</div>
{% else %}
    <div class="text-center text-muted mt-5 fade-in">
        <p>è«‹è¼¸å…¥ User ID ä»¥æŸ¥çœ‹å³æ™‚å°è©±ã€‚</p>
    </div>
{% endif %}